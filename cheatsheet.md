# LEVERAGING CLUSTERING FOR BOOKING PATTERN FORECASTING: A CASE STUDY

## Code Cheatsheet

### Datasets description:

1. **data**: DataFrame indexed by every holiday packageâ€™s departure week. The following columns are present:
   - **DestinationCountry**: The country of the destination airport. e.g., "Spain"
   - **DestinationAirport**: The code of the destination airport. e.g., "ACE"
   - **DepartureYearWeek**: The combination of the departure year and week. e.g., "2015_51"
   - **DepartureYear**: The year of departure. e.g., 2015
   - **DepartureWeek**: The week of departure. e.g., 51
   - **BookingYearWeek**: The combination of the booking year and week. e.g., "2015_45"
   - **BookingYear**: The year of booking. e.g., 2015
   - **BookingWeek**: The week of booking. e.g., 45
   - **Pax**: The number of passengers that booked during that booking week for that holiday package. e.g., 4
   - **Pax_total**: The total passengers of that holiday package. e.g., 243
   - **Passenger_Status**: Category of "high" or "low" based on the preset limit of 50 passengers for each holiday package. e.g., "high"
   - **Revenue**: The revenue generated by Sunweb that booking week for that holiday package (in euros). e.g., 200
   - **Margin**: The margin generated by Sunweb that booking week for that holiday package (in euros). e.g., 100
   - **percent**: The percentage of bookings made that booking week for that holiday package. e.g., 0.10
   - **advance**: The number of weeks in advance the booking week is from the departure week. e.g., 1

2. **df**: DataFrame indexed by every holiday package (unique combination of destination airport and departure year week). The following columns are present:
   - **DestinationCountry**: The country of the destination airport. e.g., "Spain"
   - **DestinationAirport**: The code of the destination airport. e.g., "ACE"
   - **DepartureYearWeek**: The combination of the departure year and week. e.g., "2015_51"
   - **DepartureYear**: The year of departure. e.g., 2015
   - **DepartureWeek**: The week of departure. e.g., 51
   - **Pax_total**: The total number of passengers of that holiday package. e.g., 243
   - **BookingsList**: An array of length 104 representing the percent of bookings made for each week in advance. E.g., at index 0: 0.0041 means 0.41% of the total bookings were made 0 weeks in advance (same week as departure).
   - **WeekList**: An array of length 104 representing the booking week of the year when the booking occurred. E.g., at index 0: 51, the week of departure is booking week 51, at index 1: 50, 1 week before departure is booking week 50.

###
- X_train :  all the holiday packages where the departure is between week 44, 2015 and week 44, 2018 (inclusive)
- X_train_high : all the holiday packages where the departure is between week 44, 2015 and week 44, 2018 (inclusive) that are classified as "high"
- X_train_clustering : all the holiday packages in X_trained grouped by their departure week and destination airport
- X_test: all the holiday packages where the departure is between week 45, 2018 and week 44, 2019 (inclusive)

### Forecasting models:
1. Defining forecasting models
2. [<code>GridSearchCV</code>](https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.GridSearchCV.html) with 5-fold cross-validation to optimize parameter or model selection based on minimizing the custom scorer of MSE + MAE.
3. The model is trained with the optimal parameters on the training set
4. Making forecasts for the training and test set
5. Scaling forecasts, normalizing them to sum up to 1 for every holiday package forecast
6. Store the forecasts in the dataframe for each holiday package
7. Compute and store the MSE for the forecast and the actual values
8. Compute and store the MAE for the forecast and the actual values

